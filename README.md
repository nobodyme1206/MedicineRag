# åŒ»å­¦çŸ¥è¯†é—®ç­”RAGç³»ç»Ÿ

åŸºäºæ£€ç´¢å¢å¼ºç”Ÿæˆ(RAG)çš„åŒ»å­¦çŸ¥è¯†é—®ç­”ç³»ç»Ÿï¼Œé‡‡ç”¨ Vue3 + Spring Boot + Python FastAPI ä¸‰å±‚æ¶æ„ã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- **æ™ºèƒ½é—®ç­”**: Adaptive RAG Agentï¼Œæ™ºèƒ½è·¯ç”± + è‡ªæˆ‘åæ€
- **æ··åˆæ£€ç´¢**: BM25 + å‘é‡æ£€ç´¢ + RRFèåˆ (MRR=0.93)
- **é‡æ’åº**: BGE-Reranker-v2-m3 ç²¾æ’
- **å¤šè½®å¯¹è¯**: æ”¯æŒä¸Šä¸‹æ–‡è¿½é—®
- **æ¥æºå¼•ç”¨**: ç­”æ¡ˆè‡ªåŠ¨æ ‡æ³¨æ–‡çŒ®æ¥æº

### æ•°æ®å¤„ç†
- **æ•°æ®é‡‡é›†**: PubMedåŒ»å­¦æ–‡çŒ®çˆ¬è™«ï¼Œ30ä¸ªåŒ»å­¦ä¸»é¢˜
- **æ•°æ®å¤„ç†**: PySparkåˆ†å¸ƒå¼å¤„ç†ï¼ŒParquetåˆ—å¼å­˜å‚¨
- **å‘é‡åŒ–**: BGE-small-zh-v1.5ï¼ŒGPUåŠ é€Ÿ

### æ€§èƒ½ä¼˜åŒ–
- **BM25ç¼“å­˜**: ç´¢å¼•æŒä¹…åŒ–ï¼Œå¯åŠ¨æ—¶é—´ ~30ç§’
- **è¯­ä¹‰ç¼“å­˜**: ç›¸ä¼¼é—®é¢˜å¤ç”¨ç­”æ¡ˆ
- **ç»„ä»¶å¤ç”¨**: Agentå¤ç”¨RAGç³»ç»Ÿå®ä¾‹
- **å¼‚æ­¥æ‰¹å¤„ç†**: æ”¯æŒå¹¶å‘é—®ç­”

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend (Vue3 + Element Plus)            â”‚
â”‚                         Port: 5173                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Backend (Spring Boot)                     â”‚
â”‚                         Port: 8080                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Python API (FastAPI)                      â”‚
â”‚                         Port: 7861                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Milvus    â”‚    Redis     â”‚   MongoDB    â”‚     MinIO      â”‚
â”‚    19530     â”‚    6379      â”‚    27017     â”‚   9000/9001    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
medical-rag/
â”œâ”€â”€ frontend/              # Vue3å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/        # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ api/          # APIæ¥å£
â”‚   â”‚   â””â”€â”€ router/       # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ backend/               # Spring Bootåç«¯
â”‚   â””â”€â”€ src/main/java/
â”œâ”€â”€ src/                   # Pythonæ ¸å¿ƒ
â”‚   â”œâ”€â”€ agent/            # Adaptive RAG Agent
â”‚   â”œâ”€â”€ api/              # FastAPIæ¥å£
â”‚   â”œâ”€â”€ rag/              # RAGæ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ retrieval/        # æ£€ç´¢æ¨¡å—
â”‚   â”œâ”€â”€ caching/          # Redisç¼“å­˜
â”‚   â””â”€â”€ evaluation/       # è¯„ä¼°æ¨¡å—
â”œâ”€â”€ config/               # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ docker/          # Dockeré…ç½®
â”‚   â””â”€â”€ config.py        # ç³»ç»Ÿé…ç½®
â”œâ”€â”€ data/                 # æ•°æ®ç›®å½•
â””â”€â”€ tests/                # æµ‹è¯•æ–‡ä»¶
```

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/nobodyme1206/MedicineRag.git
cd MedicineRag

# Pythonç¯å¢ƒ
python -m venv .venv
.venv\Scripts\activate  # Windows
pip install -r requirements.txt

# å‰ç«¯ç¯å¢ƒ
cd frontend
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp .env.example .env
# ç¼–è¾‘ .envï¼Œå¡«å…¥ SILICONFLOW_API_KEY ç­‰é…ç½®
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# 1. å¯åŠ¨DockeræœåŠ¡
docker compose -f config/docker/docker-compose.yml up -d

# 2. å¯åŠ¨Python API (ç«¯å£7861)
python -m src.api.main

# 3. å¯åŠ¨å‰ç«¯ (ç«¯å£5173)
cd frontend && npm run dev

# 4. (å¯é€‰) å¯åŠ¨Spring Bootåç«¯
cd backend && mvn spring-boot:run
```

### 4. è®¿é—®ç³»ç»Ÿ

- å‰ç«¯ç•Œé¢: http://localhost:5173
- APIæ–‡æ¡£: http://localhost:7861/docs
- Milvus: http://localhost:19530


## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### æ£€ç´¢è¯„ä¼° (PubMedQA 50 queries)

| æ–¹æ³• | MRR | Recall@5 | å»¶è¿Ÿ |
|------|-----|----------|------|
| BM25 | 0.570 | 0.62 | 1825ms |
| Vector | 0.897 | 0.92 | 33ms |
| **Hybrid_RAG** | **0.930** | **0.94** | 483ms |

### ç³»ç»Ÿæ€§èƒ½

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| å¯åŠ¨æ—¶é—´ | ~30ç§’ |
| å‘é‡æ•°é‡ | 1,500,000+ |
| å¹³å‡å“åº” | <3ç§’ |
| ç¼“å­˜å‘½ä¸­ç‡ | >60% |

## ğŸ”§ æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | ç”¨é€” |
|------|------|------|
| å‰ç«¯ | Vue3 + Element Plus | ç”¨æˆ·ç•Œé¢ |
| åç«¯ | Spring Boot | APIç½‘å…³ |
| AIæœåŠ¡ | FastAPI + Python | RAGæ ¸å¿ƒ |
| å‘é‡åº“ | Milvus | å‘é‡å­˜å‚¨æ£€ç´¢ |
| ç¼“å­˜ | Redis | æŸ¥è¯¢/å‘é‡ç¼“å­˜ |
| æ–‡æ¡£åº“ | MongoDB | æ—¥å¿—å­˜å‚¨ |
| å¯¹è±¡å­˜å‚¨ | MinIO | æ¨¡å‹å¤‡ä»½ |
| Embedding | BGE-small-zh-v1.5 | æ–‡æœ¬å‘é‡åŒ– |
| Reranker | BGE-Reranker-v2-m3 | ç»“æœç²¾æ’ |
| LLM | DeepSeek-V3 | ç­”æ¡ˆç”Ÿæˆ |

## ğŸ“– APIæ¥å£

### RAGé—®ç­”
```bash
POST /api/v1/ask
{
  "question": "ä»€ä¹ˆæ˜¯ç³–å°¿ç—…ï¼Ÿ",
  "session_id": "optional",
  "use_rewrite": false
}
```

### Agenté—®ç­”
```bash
POST /api/v1/agent
{
  "question": "ç³–å°¿ç—…çš„ç—‡çŠ¶å’Œæ²»ç–—æ–¹æ³•"
}
```

### æ‰¹é‡é—®ç­”
```bash
POST /api/v1/ask/batch
{
  "questions": ["é—®é¢˜1", "é—®é¢˜2"],
  "max_concurrency": 4
}
```

## ğŸ³ Dockeréƒ¨ç½²

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose -f config/docker/docker-compose.yml up -d

# æŸ¥çœ‹çŠ¶æ€
docker compose -f config/docker/docker-compose.yml ps

# åœæ­¢æœåŠ¡
docker compose -f config/docker/docker-compose.yml down
```

æœåŠ¡ç«¯å£:
- Milvus: 19530
- Redis: 6379
- MongoDB: 27017
- MinIO: 9000 (API), 9001 (Console)

## ğŸ§ª è¿è¡Œæµ‹è¯•

```bash
pytest tests/ -v
pytest tests/test_integration.py -v
```

## ğŸ“ é…ç½®è¯´æ˜

ä¸»è¦é…ç½®é¡¹ (`.env`):

| é…ç½®é¡¹ | è¯´æ˜ |
|--------|------|
| SILICONFLOW_API_KEY | LLM APIå¯†é’¥ |
| EMBEDDING_DEVICE | cuda/cpu |
| USE_HYDE | False (è¯„ä¼°æœ€ä¼˜) |
| USE_RERANK | True |

## ğŸ“„ License

MIT License
